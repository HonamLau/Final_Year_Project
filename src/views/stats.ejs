<html>

<head>
  <title>Your Statistics</title>
  <!--Load the AJAX API-->
  <script type="text/javascript" src="https://www.google.com/jsapi"></script>
  <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script> -->
  <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
    integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
    crossorigin="anonymous"></script>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

  <script type="text/javascript">


    // Load the Visualization API and the piechart package.
    google.load('visualization', '1.0', { 'packages': ['corechart'] });

    // Set a callback to run when the Google Visualization API is loaded.
    google.setOnLoadCallback(drawChart);

    // Callback that creates and populates a data table,
    // instantiates the pie chart, passes in the data and
    // draws it.

    function drawChart() {

      // Create the data table.  ******原始資料******

      var data = new google.visualization.DataTable();
      data.addColumn('string', 'date');
      data.addColumn('number', 'Usage');
      var hi = "<%= datas[0][0] %>";
      var hi2 = "<%= datas[0][1] %>";


      // data.addRow(JSON.parse(myData[0]));
      data.addRow(["<%= datas[0][0] %>".toString(), parseInt("<%= datas[0][1]%>")]);
      data.addRow(["<%= datas[1][0] %>".toString(), parseInt("<%= datas[1][1] %>")]);
      data.addRow(["<%= datas[2][0] %>".toString(), parseInt("<%= datas[2][1] %>")]);
      data.addRow(["<%= datas[3][0] %>".toString(), parseInt("<%= datas[3][1] %>")]);
      data.addRow(["<%= datas[4][0] %>".toString(), parseInt("<%= datas[4][1] %>")]);
      data.addRow(["<%= datas[5][0] %>".toString(), parseInt("<%= datas[5][1] %>")]);
      data.addRow(["<%= datas[6][0] %>".toString(), parseInt("<%= datas[6][1] %>")]);
      // }
      // *********************差異之處*************************
      // Set chart options
      var options = {
        'title': 'Energy Use in the most recent 7 days',

        //  'width':1200,
        //   'height': 600,
        chartArea: { width: "50%", height: "75%" },
        backgroundColor: '#e9e9d2'
      };

      // Instantiate and draw our chart, passing in some options.
      var chart = new google.visualization.LineChart(document.getElementById('chart_div'));
      chart.draw(data, options);
    }

    $(window).resize(function () {
      drawChart();
    })

  </script>

  <script type="text/javascript">


    google.load('visualization', '1.0', { packages: ['corechart', 'bar'] });
    google.setOnLoadCallback(drawBasic);

    function drawBasic() {

      var data = new google.visualization.DataTable();

      data.addColumn('string', 'Date&Time');
      data.addColumn('number', 'Peek Current');

      data.addRow(["<%= datas2[0][0] %>".toString(), parseInt("<%= datas2[0][1] %>")]);
      data.addRow(["<%= datas2[1][0] %>".toString(), parseInt("<%= datas2[1][1] %>")]);
      data.addRow(["<%= datas2[2][0] %>".toString(), parseInt("<%= datas2[2][1] %>")]);
      data.addRow(["<%= datas2[3][0] %>".toString(), parseInt("<%= datas2[3][1] %>")]);
      data.addRow(["<%= datas2[4][0] %>".toString(), parseInt("<%= datas2[4][1] %>")]);
      data.addRow(["<%= datas2[5][0] %>".toString(), parseInt("<%= datas2[5][1] %>")]);
      data.addRow(["<%= datas2[6][0] %>".toString(), parseInt("<%= datas2[6][1] %>")]);



      var options = {
        title: 'Time of which power usage at its Peek(most recent 7 days)',


        chartArea: { width: "50%", height: "75%" },



        backgroundColor: '#e9e9d2'

      };

      var chart = new google.visualization.ColumnChart(
        document.getElementById('peak'));

      chart.draw(data, options);
      // window.addEventListener('resize', drawBasic, false);

    }
    $(window).resize(function () {
      drawBasic();
    })
  </script>
  <script type="text/javascript">
    google.charts.load('current', { 'packages': ['corechart'] });
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
      var m = parseInt("<%=m%>");
      var an = parseInt("<%=an%>");
      var data = google.visualization.arrayToDataTable([
        ['Energy Use', 'Morning/afternoon'],
        ['Morning', m],
        ['Afternoon', an],

      ]);

      var options = {

        title: 'When would your peak usage of electricity happen? (Recent 7 days)',
        is3D: true,
        chartArea: { width: "50%", height: "75%" },



        backgroundColor: '#e9e9d2'

      };

      var chart = new google.visualization.PieChart(document.getElementById('distribution'));

      chart.draw(data, options);
    }
    $(window).resize(function () {
      drawChart();
    })

  </script>


</head>

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
    integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
  <!-- <link href="css/styles.css" /> -->
  <style>
    body {
      background-color: rgb(233, 233, 210);
    }
  </style>

  <link href="../styles/style.css" rel="stylesheet" type="text/css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

</head>
<style>
  /* button {position: relative; left:50px;} */
  .dropbtn {
    position: relative;
    left: 50px;
    background-color: brown;
    color: white;
    padding: 16px;
    font-size: 16px;
    border: none;
  }

  .dropbtn2 {
    position: relative;
    left: 50px;
    background-color: #4CAF50;
    color: white;
    padding: 16px;
    font-size: 16px;
    border: none;
  }

  .dropbtn3 {
    position: relative;
    left: 50px;
    background-color: rgb(86, 76, 175);
    color: white;
    padding: 16px;
    font-size: 16px;
    border: none;
  }

  .dropdown {
    position: relative;
    display: inline-block;
    text-align: center;
    left: 20%
  }

  .dropdown-content {
    display: none;
    position: absolute;
    background-color: #f1f1f1;
    min-width: 160px;
    box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
    z-index: 1;
  }

  .dropdown-content a {
    color: black;
    padding: 12px 16px;
    text-decoration: none;
    display: block;
  }

  .dropdown-content a:hover {
    background-color: #ddd;
  }

  .dropdown:hover .dropdown-content {
    display: block;
  }

  .dropdown:hover .dropbtn {
    background-color: #3e8e41;
  }
</style>

<body>
  <!-- nav bar -->
  <section id="nav">
    <nav class="navbar navbar-dark navbar-expand-lg bg-info fixed-top flex-md-nowrap shadow">
      <div class="navbar-header">
        <button class="btn btn-info" type="button" id="sideButton">
          <i class="fa fa-bars" style="font-size: 1.5rem;"></i>
        </button>

        <a class="navbar-brand" href="../../">Green Office Network</a>
      </div>
    </nav>

    <!-- side nav bar -->


    <nav id="sideMenu" class="sideMenu">
      <div>
        <button class="btn" type="button" id="sideClose">
          <i class="fa fa-arrow-left" style="font-size: 24px;"></i>
        </button>
      </div>
      <div class="sidebar-header">
        <h3 style="word-wrap: break-word;">
          <i class="fa fa-user-circle"></i><%=name%>
        </h3>
      </div>

      <ul class="navbar-nav menuItem">

        <li class="nav-item">
          <a class="nav-link" href="../../">
            <i class="fa fa-home"></i>Home</a>
        </li>

        <li class="nav-item">
          <a href="#powerUse" data-toggle="collapse" aria-expanded="false" class="nav-link">
            <i class="fa fa-battery-3"></i> Power Use
          </a>
          <ul class="collapse list-unstyled" id="powerUse">

            <li class="nav-item">
              <a class="nav-link" href="">
                <i class="fa fa-area-chart"></i>Statistics
              </a>
            </li>

            <li class="nav-item">
              <a class="nav-link" href="../../powerPlan/managePower">
                <i class="fa fa-calendar-o"></i>Schedule Power Plans
              </a>
            </li>

          </ul>
        </li>
        <% if (locals.lv>=5) { %>
        <li class="nav-item">

          <a href="#officeSetting" data-toggle="collapse" aria-expanded="false" class="nav-link">
            <i class="fa fa-group"></i>Office
          </a>

          <ul class="collapse list-unstyled" id="officeSetting">

            <li class="nav-item">
              <a class="nav-link" href="../../office/addSocket">
                <i class="fa fa-plus"></i>Add New Socket
              </a>
            </li>


            <li class="nav-item">
              <a class="nav-link" href="../../office/officeManage">
                <i class="fa fa-eye"></i>Manage Office Environment</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="../../office/assignToSocket">
                <i class="fa fa-plug"></i>Socket Management</a>
            </li>

          </ul>

        </li>
        <% } %>

        <% if (locals.lv>=10) { %>
        <li class="nav-item">
          <a href="#adminSetting" data-toggle="collapse" aria-expanded="false" class="nav-link">
            <i class="fa fa-gear"></i>Settings
          </a>
          <ul class="collapse list-unstyled" id="adminSetting">
            <!-- <li class="nav-item">
                    <a class="nav-link" href="adminSetting/configs"> 
                      <i class="fa fa-sliders"></i>System Configuration
                    </a>
                  </li> -->
            <li class="nav-item">
              <a class="nav-link" href="../../adminSetting/permissionManage">
                <i class="fa fa-sliders"></i>Manager User Permission
              </a>
            </li>
          </ul>
        </li>
        <% } %>
      </ul>

      <ul class="navbar-nav">
        <li class="nav-item" id="sideLogout">
          <a class="nav-link" id="logout" href="/auth/logout" onclick="return confirm('sure?')">Log out</a>
        </li>
      </ul>
    </nav>
  </section>
  <!-- nav end -->

  <div class="main">
    <!--Div that will hold the pie chart-->

    <div id="chart_div"></div>
    <br>
    <div id="peak"></div>
    <br>
    <div id="distribution"></div>
    <!-- <li><%= datas[0][0] %></li> -->
    <!-- <div class="row" style="max-width: 330px;">
       
      <button class="btn btn-block btn-success"  id='lol' >Switch to Peek Usage View</button>
    
    </div> -->

    <!-- <div class="dropdown">
          <button class="dropbtn">Switch to other views..</button>
          <div class="dropdown-content">
            <a href="/powerUse/peekUse">By Year</a>
            <a href="/powerUse/minUse">By Month</a>
            <a href="/powerUse/lookup">By Week</a>
          </div>
        </div> -->
    <div class="form-group">
      <% if (locals.lv>=5) { %>
      <select class="form-control" onchange="viewOthers()" id="whichPersonToView"
        style="display: inline-block; width: 25%; text-align-last:center;">
        <option value="" disabled selected hidden>Click to view other sockets(by IDs)</option>

      </select>
      <% } %>

      <button class="dropbtn3" onclick="location.href='/powerUse/lookup'">My Weekly Statistics</button>

      <button class="dropbtn" onclick="location.href='/powerUse/Yearly'">My Yearly Statistics</button>
      <button class="dropbtn2" onclick="location.href='/powerUse/Monthly'">My Monthly Statistics</button>
    </div>
  </div>

  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
    integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
    crossorigin="anonymous"></script>
  <script src="../js/sideMenu.js"></script>
</body>
<script>
  var temp = document.getElementById("whichPersonToView");
  var uws = "<%= UWS %>";
  var tempArray = uws.split(",");
  for (var i = 0; i < tempArray.length; i = i + 2) {
    var s = "id: " + tempArray[i].toString() + " (" + "user: " + tempArray[i + 1].toString() + ")";
    var option = document.createElement("option");
    option.text = s;
    option.value = tempArray[i].toString(); //value is the socket ID
    console.log("option value = " + option.value)
    temp.add(option);
  }
</script>
<script>
  function viewOthers() {
    //pass the option value(id)
    //render lookup with this id
    var selection = document.getElementById("whichPersonToView");
    var id = selection.options[selection.selectedIndex].value;
    console.log("id to be viewed = " + id);
    var uws = "<%= UWS %>";
    var tempArray = uws.split(",");
    var userViewing = "";
    for (var i = 0; i < tempArray.length; ++i) {
      if (tempArray[i] == id) {
        userViewing = tempArray[i + 1];
        break;
      }
    }
    location.href = '/powerUse/othersWeekly/?id=' + id.toString() + '&userViewing=' + userViewing.toString();

  }
</script>

</html>